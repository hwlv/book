## 进程和线程

举个例子，一个工厂，它有自己独立的资源，工厂和工厂之间相互独立，各自做各自的事情。一个场子可以有很多工人，工人可以 单个作业 也可以 协同作业，工人做的事情，都只会在自己的工厂内，并且共享这个工厂的空间。

我们现在把概念放到进程上，一个进程就相当于一个工厂，工厂里的资源就相当于系统分配的独立内存，多个工厂各自做各自的事情就相当于进程之间相互独立，一个工厂有很多工人就相当于一个进程可以有很多线程，工人的作业就相当于线程完成任务，工人共享这个工厂的空间，就相当于一个进程下面的线程之间可以共享程序的内存。

**大家所说的多线程和单线程，都是只在一个进程内的多和单！**



![img](https://tva1.sinaimg.cn/large/e6c9d24egy1h3ulrr1vayj20j10ip0ua.jpg)

## 浏览器的进程

在 Chrome 多进程架构里，它包括了四个进程：

- Browser进程（负责地址栏、书签栏、前进后退、网络请求、文件访问等）
- Renderer进程（**负责一个Tab内所有和网页渲染有关的所有事情，是最核心的进程**）
- GPU进程（负责GPU相关的任务）
- Plugin进程（负责Chrome插件相关的任务）



## 渲染

先说几个渲染进程内将要工作的线程：

- 主线程(Main thread)：**下载资源、执行js、计算样式、进行布局、绘制合成**
- 光栅线程（Raster thread）
- 合成线程（Compositor thread）
- 工作线程（Worker thread）



1. 当渲染过程接收提交消息用于导航和开始接收HTML数据，主线程开始解析文本串（HTML），使之成为一个 `Document Object Model` ，也就是 `DOM`。

2. 网站有用到图片，CSS 和JavaScript的话，这些东西需要从网络或者缓存中加载，主线程可以边请求，边预加载构建DOM。

3. 当HTML解析器找到 `<script>` 标签后，将会暂停HTML解析，并且必须加载、解析和执行 JavaScript的代码。为什么？因为JavaScript 可以使用诸如 `document.write()` 更改整个DOM结构！所以开发人员在写代码的时候可以在` <script>` 标签上加 `async` 或者 `defer` 属性。然后浏览器将会异步加载并运行JavaScript，不会阻止解析。

4. 主线程解析CSS样式，并把CSS样式一一对应到DOM节点上，注意，此时CSS页面还没有生效，只是样式和节点绑定了关系。

5. 接下来CSS根据DOM节点，会生成类似于DOM结构的一个布局树，仅包含了页面上可见内容的信息，如果有 `display: none` 等，则该元素不属于布局树。如果有 `p::before {content:"123"}` 等伪类的存在，就算它不在DOM中，也会包含在布局树中。

   

6. 

   
   